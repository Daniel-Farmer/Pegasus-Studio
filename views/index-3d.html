<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pegasus Studio 3D</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { width:100%; height:100%; overflow:hidden; background:#fff; }
#game-canvas {
  display:block; width:100%; height:100%;
  touch-action:none;
}

/* Loading screen */
#loading-screen {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#ffffff;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:100; color:#2A1810; font-family:Georgia, serif;
}
#loading-screen h1 { font-size:2.2em; margin-bottom:0.3em; color:#1a1a1a; }
#loading-screen p { font-size:1em; color:#888; margin-bottom:1.5em; }
.loader-bar { width:200px; height:4px; background:#ddd; border-radius:2px; overflow:hidden; }
.loader-fill { width:0%; height:100%; background:#333; transition:width 0.3s; }

/* Crosshair */
#crosshair {
  display:none; position:fixed; top:50%; left:50%;
  transform:translate(-50%,-50%); pointer-events:none; z-index:10;
  width:20px; height:20px;
}
#crosshair::before, #crosshair::after {
  content:''; position:absolute; background:rgba(255,255,255,0.6);
}
#crosshair::before { width:2px; height:20px; left:9px; top:0; }
#crosshair::after  { width:20px; height:2px; left:0; top:9px; }

/* Mobile joystick */
#joystick-base {
  display:none; position:fixed; width:120px; height:120px;
  border-radius:50%; border:2px solid rgba(255,255,255,0.25);
  background:rgba(0,0,0,0.15); pointer-events:none; z-index:20;
}
#joystick-knob {
  position:absolute; width:50px; height:50px;
  border-radius:50%; background:rgba(255,255,255,0.35);
  pointer-events:none;
}

/* Controls hint */
#controls-hint {
  position:fixed; bottom:12px; left:50%; transform:translateX(-50%);
  color:rgba(255,255,255,0.5); font:12px sans-serif; pointer-events:none; z-index:10;
  text-align:center;
}

/* Dialog overlay */
#dialog-overlay {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  align-items:center; justify-content:center; z-index:50;
  pointer-events:none;
}
.dialog-box {
  background:rgba(0,0,0,0.85); color:#fff; padding:24px 32px;
  border-radius:8px; max-width:400px; text-align:center;
  font-family:'Segoe UI', Arial, sans-serif;
}
.dialog-title { font-size:1.3em; font-weight:bold; margin-bottom:8px; }
.dialog-text { font-size:1em; color:#ccc; }
</style>
</head>
<body>

<canvas id="game-canvas"></canvas>

<!-- Loading screen -->
<div id="loading-screen">
  <h1>Pegasus Studio</h1>
  <p>Loading 3D world...</p>
  <div class="loader-bar"><div class="loader-fill" id="loader-fill"></div></div>
</div>

<!-- Crosshair -->
<div id="crosshair"></div>

<!-- Mobile joystick -->
<div id="joystick-base">
  <div id="joystick-knob"></div>
</div>

<!-- Controls hint -->
<div id="controls-hint"></div>

<!-- Dialog overlay for script system -->
<div id="dialog-overlay">
  <div class="dialog-box">
    <div class="dialog-title"></div>
    <div class="dialog-text"></div>
  </div>
</div>

<!-- Three.js (bundled locally) -->
<script src="js/lib/three.min.js"></script>
<script src="js/lib/GLTFLoader.js"></script>

<!-- Game scripts in dependency order -->
<script src="js/scene-id.js"></script>
<script src="js/scene-schema.js"></script>
<script src="js/scene-loader.js"></script>
<script src="js/controls.js"></script>
<script src="js/collision.js"></script>
<script src="js/npcs.js"></script>
<script src="js/engine.js"></script>
<script src="js/face-material.js"></script>
<script src="js/builder-single.js"></script>
<script src="js/script-registry.js"></script>
<script src="js/world.js"></script>
<script src="js/main.js"></script>

<script>
// Show controls hint based on device
(function() {
  var hint = document.getElementById('controls-hint');
  if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
    hint.textContent = 'Left: move | Right: look';
  } else {
    hint.textContent = 'Click to look | WASD to move | Shift to sprint';
  }
  setTimeout(function() { hint.style.opacity = '0'; hint.style.transition = 'opacity 2s'; }, 8000);
})();

// Loading bar animation
(function() {
  var fill = document.getElementById('loader-fill');
  if (fill) {
    var p = 0;
    var iv = setInterval(function() {
      p = Math.min(p + 15, 90);
      fill.style.width = p + '%';
      if (p >= 90) clearInterval(iv);
    }, 100);
  }
})();
</script>

</body>
</html>
